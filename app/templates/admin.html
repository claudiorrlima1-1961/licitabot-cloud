<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Painel do Administrador ‚Äî Licitabot</title>
  <style>
    :root {
      --bg:#f5f7fa; --card:#fff; --txt:#1f2937;
      --muted:#475569; --btn:#0b3d5c; --ok:#166534; --err:#991b1b;
    }
    html,body {height:100%;margin:0;background:var(--bg);font-family:Arial,Helvetica,sans-serif;color:var(--txt);}
    .container {display:flex;flex-direction:column;align-items:center;justify-content:flex-start;min-height:100vh;padding:24px;}
    .card {width:100%;max-width:520px;background:var(--card);border-radius:16px;
           box-shadow:0 10px 28px rgba(0,0,0,.12);padding:24px;margin-bottom:20px;}
    h1{margin:0 0 8px;font-size:22px;color:#0b2942;text-align:center}
    .sub{margin:0 0 16px;font-size:14px;color:var(--muted);text-align:center}
    input,button,select{width:100%;box-sizing:border-box;font-size:15px;}
    input[type=password],input[type=file]{margin:8px 0 12px;padding:10px;border:1px solid #cbd5e1;border-radius:10px}
    button{background:var(--btn);color:#fff;border:none;padding:12px;border-radius:10px;font-weight:600;cursor:pointer;margin-top:6px}
    button:hover{filter:brightness(1.05)}
    #status{margin-top:12px;font-size:14px;max-height:260px;overflow:auto}
    .ok{color:var(--ok)} .err{color:var(--err)}
    ul{list-style:none;padding-left:0}
    li{margin:4px 0;display:flex;justify-content:space-between;align-items:center}
    .btn-small{background:#0b3d5c;color:#fff;border:none;border-radius:8px;padding:4px 10px;cursor:pointer;font-size:13px}
    .btn-del{background:#991b1b;}
    .btn-small:hover{filter:brightness(1.15)}
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Envio de PDFs (Administrador)</h1>
      <p class="sub">Insira a senha do administrador (ADMIN_UPLOAD_TOKEN) e envie seus arquivos.</p>
      <input id="senha" type="password" placeholder="Senha do admin"/>
      <input id="arquivo" type="file" accept="application/pdf" multiple/>
      <button onclick="enviar()">üì§ Enviar PDFs</button>
      <button onclick="listar()">üìÑ Ver PDFs Enviados</button>
      <div id="status"></div>
    </div>
  </div>

  <script>
    const status = document.getElementById('status');

    async function enviar(){
      const senha = document.getElementById('senha').value.trim();
      const arquivos = document.getElementById('arquivo').files;
      status.innerHTML = '';
      if(!senha){ status.innerHTML='<p class="err">Informe a senha.</p>'; return; }
      if(!arquivos.length){ status.innerHTML='<p class="err">Selecione ao menos 1 PDF.</p>'; return; }

      for(let i=0;i<arquivos.length;i++){
        const fd = new FormData(); fd.append('file', arquivos[i]);
        try{
          const r = await fetch('/upload_pdf', { method:'POST', headers:{'X-Admin-Token':senha}, body:fd });
          const j = await r.json();
          if(r.ok){
            status.innerHTML += `<p class="ok">‚úÖ ${j.filename} enviado com sucesso.</p>`;
          }else{
            status.innerHTML += `<p class="err">‚ùå ${arquivos[i].name}: ${j.detail || 'Erro desconhecido.'}</p>`;
          }
        }catch(err){
          status.innerHTML += `<p class="err">‚ùå ${arquivos[i].name}: ${err.message}</p>`;
        }
      }
    }

    async function listar(){
      const senha = document.getElementById('senha').value.trim();
      status.innerHTML = '';
      if(!senha){ status.innerHTML='<p class="err">Informe a senha.</p>'; return; }

      try{
        const r = await fetch('/list_pdfs', { headers:{'X-Admin-Token':senha} });
        if(!r.ok){ throw new Error('Token inv√°lido ou erro no servidor.'); }
        const j = await r.json();
        if(!j.files.length){ status.innerHTML='<p class="err">Nenhum PDF encontrado.</p>'; return; }

        let html = '<ul>';
        for(const f of j.files){
          html += `<li>üìÑ ${f}
                     <div>
                       <button class="btn-small" onclick="verPDF('${f}')">Ver</button>
                       <button class="btn-small btn-del" onclick="deletar('${f}')">Excluir</button>
                     </div>
                   </li>`;
        }
        html += '</ul>';
        status.innerHTML = html;
      }catch(e){
        status.innerHTML = `<p class="err">${e.message}</p>`;
      }
    }

    function verPDF(nome){
      window.open('/data/uploaded_pdfs/'+nome, '_blank');
    }

    async function deletar(nome){
      const senha = document.getElementById('senha').value.trim();
      if(!confirm(`Deseja realmente excluir o arquivo "${nome}"?`)) return;
      try{
        const r = await fetch(`/delete_pdf?name=${encodeURIComponent(nome)}`, {
          method:'DELETE',
          headers:{'X-Admin-Token':senha}
        });
        if(!r.ok){ throw new Error('Erro ao excluir.'); }
        const j = await r.json();
        status.innerHTML += `<p class="ok">üóëÔ∏è ${j.deleted} exclu√≠do com sucesso.</p>`;
        listar();
      }catch(e){
        status.innerHTML = `<p class="err">${e.message}</p>`;
      }
    }
  </script>
</body>
</html>
