<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>LICITABOT — Assessoria de Licitações e Contratos</title>
  <style>
    :root{
      --bg:#f5f7fa; --card:#ffffff; --txt:#0b2942; --muted:#475569;
      --btn:#0b3d5c; --ok:#166534; --err:#991b1b; --border:#cbd5e1;
    }
    html,body{height:100%;margin:0;font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:#1f2937}
    .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:24px}
    .card{width:100%;max-width:820px;background:var(--card);border-radius:16px;box-shadow:0 12px 28px rgba(0,0,0,.12);padding:24px}
    .grid{display:grid;grid-template-columns:1fr;gap:20px}
    @media (min-width:900px){ .grid{grid-template-columns: 1fr 1fr;} }

    h1{margin:0 0 6px;color:var(--txt);font-size:22px}
    .lead{margin:0 0 10px;color:var(--muted);font-size:14px;line-height:1.35}
    .bullet{margin:4px 0 0;color:#334155;font-size:13px}
    .panel{border:1px solid var(--border); border-radius:14px; padding:16px}

    label{display:block; font-weight:600; margin-bottom:6px; color:#0b2942}
    input, textarea, button{width:100%; box-sizing:border-box; font-size:15px}
    input[type=password], input[type=text], textarea{
      border:1px solid var(--border); border-radius:10px; padding:10px; background:#fff;
    }
    textarea{min-height:120px; resize:vertical}
    button{
      margin-top:10px; background:var(--btn); color:#fff; border:none; padding:12px;
      border-radius:10px; font-weight:700; cursor:pointer;
    }
    button:hover{filter:brightness(1.05)}
    .muted{color:var(--muted); font-size:12px}
    .status{margin-top:10px; font-size:14px}
    .ok{color:var(--ok)} .err{color:var(--err)}
    .answer{white-space:pre-wrap; border:1px solid var(--border); border-radius:10px; padding:12px; background:#fff; min-height:90px}
    footer{margin-top:14px; font-size:12px; color:#475569}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="grid">
        <!-- Coluna 1: Apresentação -->
        <div class="panel">
          <h1>LICITABOT — Assessoria de Licitações e Contratos</h1>
          <p class="lead"><strong>Não é apenas um chatbot.</strong> É anos de <strong>experiência</strong> em licitações e contratos aplicados a uma <strong>IA especializada</strong>.</p>
          <p class="bullet">• Base especializada — usamos documentos reais da área, não conteúdo genérico.</p>
          <p class="bullet">• Conhecimento prático — anos de experiência aplicada no setor público.</p>
          <p class="bullet">• Respostas contextuais — entende nuances de contratos e licitações.</p>
          <p class="bullet">• Fontes citadas (no modo admin) — transparência sobre a origem.</p>
          <footer>
            Isto não substitui consulta/parecer jurídico formal.
          </footer>
        </div>

        <!-- Coluna 2: Acesso + Perguntas -->
        <div class="panel">
          <!-- BLOCO DE LOGIN -->
          <div id="loginBox">
            <label for="password">Senha de acesso</label>
            <input id="password" type="password" placeholder="Digite a senha fornecida após a assinatura"/>
            <button id="btnLogin" onclick="doLogin()">Entrar</button>
            <div id="loginStatus" class="status"></div>
          </div>

          <!-- BLOCO DE PERGUNTAS (inicia oculto) -->
          <div id="qaBox" style="display:none">
            <label for="question">Faça perguntas específicas sobre licitações e contratos</label>
            <textarea id="question" placeholder="Ex.: Quando o uso de conta vinculada é obrigatório? Como ficam as garantias no RDC?"></textarea>
            <button id="btnAsk" onclick="doAsk()">Perguntar</button>
            <div id="askStatus" class="status"></div>

            <div style="margin-top:12px">
              <label>Resposta</label>
              <div id="answer" class="answer"></div>
            </div>

            <footer>
              O assistente usa uma base especializada e prática, construída a partir de anos de trabalho na área por Cláudio Lima.
            </footer>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  // UI helpers
  const loginBox   = document.getElementById('loginBox');
  const qaBox      = document.getElementById('qaBox');
  const loginStat  = document.getElementById('loginStatus');
  const askStat    = document.getElementById('askStatus');
  const answerEl   = document.getElementById('answer');

  async function doLogin(){
    const pwd = (document.getElementById('password').value || '').trim();
    loginStat.innerHTML = '';
    if(!pwd){
      loginStat.innerHTML = '<span class="err">Informe a senha.</span>';
      return;
    }
    try{
      const r = await fetch('/login', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({password: pwd})
      });
      if(!r.ok){
        const j = await r.json().catch(()=>({}));
        loginStat.innerHTML = '<span class="err">'+ (j.error || 'Senha incorreta.') +'</span>';
        return;
      }
      // Sucesso: mostra perguntas
      loginStat.innerHTML = '<span class="ok">Acesso liberado.</span>';
      loginBox.style.display = 'none';
      qaBox.style.display = 'block';
      // foco no campo pergunta
      setTimeout(()=>document.getElementById('question').focus(), 50);
    }catch(e){
      loginStat.innerHTML = '<span class="err">Falha de conexão.</span>';
    }
  }

  async function doAsk(){
    const q = (document.getElementById('question').value || '').trim();
    askStat.innerHTML = '';
    answerEl.textContent = '';
    if(!q){
      askStat.innerHTML = '<span class="err">Escreva sua pergunta.</span>';
      return;
    }
    askStat.innerHTML = 'Consultando a base…';

    try{
      // Atenção: o cookie de sessão (definido no /login) faz a autenticação
      const r = await fetch('/ask', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({question: q})
      });

      const j = await r.json().catch(()=>({answer:'Erro ao interpretar resposta.'}));
      if(!r.ok){
        askStat.innerHTML = '<span class="err">Acesso expirado. Faça login novamente.</span>';
        // volta o login se perdeu o cookie
        loginBox.style.display = 'block';
        qaBox.style.display = 'none';
        return;
      }
      askStat.innerHTML = '';
      answerEl.textContent = j.answer || '(Sem conteúdo)';
    }catch(e){
      askStat.innerHTML = '<span class="err">Erro de conexão.</span>';
    }
  }

  // Atalhos de teclado
  document.getElementById('password').addEventListener('keydown', (ev)=>{
    if(ev.key === 'Enter'){ doLogin(); }
  });
  document.getElementById('question').addEventListener('keydown', (ev)=>{
    if((ev.ctrlKey || ev.metaKey) && ev.key.toLowerCase() === 'enter'){ doAsk(); }
  });
</script>
</body>
</html>
