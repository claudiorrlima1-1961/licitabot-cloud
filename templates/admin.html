<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Admin ‚Äî Licitabot</title>
  <style>
    :root {
      --txt:#1f2937;
      --muted:#64748b;
      --btn:#0b3d5c;
      --ok:#166534;
      --err:#991b1b;
      --bg:#f5f7fa;
    }
    html, body {
      height:100%; margin:0;
      font-family:Arial,Helvetica,sans-serif;
      background:var(--bg); color:var(--txt);
    }
    .tabs {
      display:flex; justify-content:center; gap:8px;
      padding:16px; background:#e2e8f0;
      position:sticky; top:0; z-index:10;
      border-bottom:1px solid #cbd5e1;
    }
    .tab {
      display:flex; align-items:center; gap:4px;
      background:#fff; border:none;
      padding:10px 16px; border-radius:12px;
      font-weight:600; cursor:pointer;
      box-shadow:0 2px 4px rgba(0,0,0,.08);
      transition:.2s;
    }
    .tab:hover { filter:brightness(1.05); }
    .card {
      width:100%; max-width:480px;
      background:#fff; margin:40px auto;
      padding:24px; border-radius:16px;
      box-shadow:0 10px 28px rgba(0,0,0,.1);
    }
    h1 { margin:0 0 8px; color:#0b2942; font-size:22px; }
    p.sub { margin:0 0 16px; color:var(--muted); font-size:14px; }
    input, button {
      width:100%; box-sizing:border-box;
      font-family:inherit; font-size:15px;
    }
    input[type=password], input[type=file] {
      margin:8px 0 12px;
      padding:10px; border:1px solid #cbd5e1; border-radius:10px;
    }
    button {
      border:none; border-radius:10px;
      color:#fff; background:var(--btn);
      font-weight:600; padding:12px; cursor:pointer;
      transition:.2s;
    }
    button:hover { filter:brightness(1.05); }
    #status { margin-top:12px; font-size:14px; min-height:20px; }
    .ok { color:var(--ok); }
    .err { color:var(--err); }
    .muted { color:var(--muted); }
    .chip {
      display:inline-block;
      background:#f1f5f9;
      border-radius:10px;
      padding:8px 12px;
      margin:6px 8px 6px 0;
      font-size:14px;
      box-shadow:0 1px 2px rgba(0,0,0,.08);
    }
    .del {
      background:#dc2626;
      color:#fff;
      border:none;
      border-radius:8px;
      padding:6px 10px;
      margin-left:6px;
      cursor:pointer;
      font-size:13px;
    }
    .del:hover { filter:brightness(1.1); }
  </style>
</head>
<body>
  <div class="tabs">
    <button class="tab" id="tabUpload"><span>üì¶</span><b>Upload</b></button>
    <button class="tab" id="tabVer"><span>üìÅ</span><b>Ver PDFs</b></button>
    <a class="tab" href="/" style="text-decoration:none;color:inherit"><span>üí¨</span><b>Chat</b></a>
  </div>

  <div class="card">
    <h1>Envio de PDFs (Admin)</h1>
    <p class="sub">Digite a senha do administrador e selecione um ou mais PDFs.</p>
    <input id="senha" type="password" placeholder="Senha do admin (ADMIN_UPLOAD_TOKEN)" />
    <input id="arquivo" type="file" accept="application/pdf" multiple />
    <button id="btnUpload">Enviar PDFs</button>

    <div style="margin-top:10px;"></div>
    <button id="btnListar" style="background:#075985;">Atualizar lista</button>

    <div id="status"></div>

    <p style="margin-top:10px;font-size:13px;color:var(--muted)">
      Dica: ap√≥s enviar, a indexa√ß√£o roda em segundo plano.<br/>
      Voc√™ pode clicar em <b>Ver PDFs</b> para confirmar se o nome apareceu e abrir o arquivo.
    </p>

    <div id="lista" style="margin-top:10px;"></div>
  </div>

  <script>
    function token(){ return (document.getElementById('senha').value || '').trim(); }
    function msgOk(t){ document.getElementById('status').innerHTML = '<p class="ok">'+t+'</p>'; }
    function msgErr(t){ document.getElementById('status').innerHTML = '<p class="err">'+t+'</p>'; }

    async function listar(){
      const senha = token();
      const r = await fetch('/list_pdfs', { headers:{'X-Admin-Token':senha}});
      const box = document.getElementById('lista');
      box.innerHTML='';
      if(!r.ok){ box.innerHTML='<p class="err">Erro ao listar. Verifique a senha.</p>'; return; }
      const j = await r.json();
      if(!j.files || !j.files.length){ box.innerHTML='<p class="muted">Nenhum PDF enviado.</p>'; return; }
      j.files.forEach(name=>{
        const row=document.createElement('div');
        row.className='chip';
        const link=document.createElement('a');
        link.href='/pdfs/'+encodeURIComponent(name);
        link.textContent=name;
        link.target='_blank';
        link.style.textDecoration='none';
        link.style.color='inherit';
        row.appendChild(link);
        const del=document.createElement('button');
        del.className='del';
        del.textContent='Excluir';
        del.onclick=async()=>{
          if(!confirm('Excluir "'+name+'"?'))return;
          const rr=await fetch('/delete_pdf?name='+encodeURIComponent(name),{
            method:'DELETE',headers:{'X-Admin-Token':senha}
          });
          if(rr.ok){ msgOk('Exclu√≠do: '+name); listar(); }
          else{ msgErr('Falha ao excluir'); }
        };
        row.appendChild(del);
        box.appendChild(row);
      });
    }

    async function enviar(){
      const senha=token();
      const files=document.getElementById('arquivo').files;
      if(!senha){return msgErr('Informe a senha.');}
      if(!files.length){return msgErr('Selecione ao menos 1 PDF.');}
      msgOk('Enviando...');
      for(let i=0;i<files.length;i++){
        const fd=new FormData(); fd.append('file',files[i]);
        const r=await fetch('/upload_pdf',{method:'POST',headers:{'X-Admin-Token':senha},body:fd});
        if(r.ok){
          const j=await r.json();
          msgOk('üìÑ '+j.filename+' => upload OK.');
        }else{
          const e=await r.text();
          msgErr('Falha ao enviar '+files[i].name+': '+e);
          return;
        }
      }
      listar();
    }

    document.getElementById('btnUpload').onclick=enviar;
    document.getElementById('btnListar').onclick=listar;
    document.getElementById('tabVer').onclick=()=>{
      listar();
      document.getElementById('lista').scrollIntoView({behavior:'smooth'});
    };
    document.getElementById('tabUpload').onclick=()=>{
      window.scrollTo({top:0,behavior:'smooth'});
    };
  </script>
</body>
</html>
