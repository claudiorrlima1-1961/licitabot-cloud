<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LICITABOT — Chat</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <div class="wrap">
    <section class="section">
      <h2>LICITABOT — Licitações & Contratos</h2>
      <p class="sub">Faça sua pergunta. O assistente consulta a base (RAG) e cita as fontes quando necessário.</p>

      <div id="chat" class="messages" style="height:380px;overflow:auto;"></div>

      <div class="ask-row">
        <input id="q" class="ask" placeholder="Faça sua pergunta..." />
        <button id="send" class="btn-primary">Perguntar</button>
      </div>

      <p class="legal">Isto não substitui consulta/parecer jurídico formal.</p>
    </section>
  </div>

  <script>
  function add(role,txt){
    const c=document.getElementById('chat');
    const d=document.createElement('div');
    d.className='msg '+(role==='user'?'user':'');
    d.innerText=txt;
    c.appendChild(d); c.scrollTop=c.scrollHeight;
  }
  async function ask(){
    const i=document.getElementById('q');
    const q=i.value.trim(); if(!q) return;
    add('user', q); i.value='';
    add('bot','pensando...');
    const r=await fetch('/ask',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({question:q})});
    const d=await r.json();
    document.querySelector('#chat .msg:last-child').innerText = d?.answer || 'Sem resposta';
  }
  document.getElementById('send').onclick=ask;
  document.getElementById('q').addEventListener('keydown',e=>{if(e.key==='Enter')ask();});
  </script>
</body>
</html>
